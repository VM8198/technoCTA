<?phpClass HomesController extends AppController{         var $uses = array('Home','Gallery','GalleryImage','Sector','Course','Location','Content','Sponsor','SponsorImage','TransactionLog','Bookinglog');     var $components =array('Auth','Session');          function beforeFilter() {         $this->Auth->allow('index','getCourse','getcourseajax','getlocationajax','sign');         parent::beforeFilter();     }          function index(){         $this->layout ='Home';		 $gallery = $this->GalleryImage->find('all',array('limit'=> 4));         $sector = $this->Sector->find('all');         $course = $this->Course->find('all',array('order'=> array('Course.course_name'=> 'ASC')));         $location = $this->Location->find('all');		 $training_courses = $this->Content->find('first',array('conditions'=>array('Content.title'=>'Our Training Courses')));		 $index = $this->Content->find('first',array('conditions'=>array('Content.title'=>'Why Choose Techno CTA Ltd')));         $sponsor = $this->SponsorImage->find('all',array('conditions' => array('SponsorImage.title_id' =>1)));		 $heading = $this->Content->find('first',array('conditions'=>array('Content.title'=>'Welcome heading')));		  $content = $this->Content->find('first',array('conditions'=>array('Content.title'=>'Welcome content')));		 //pr($sponsor); die;		 $this->set(compact('gallery','course','sector','location','training_courses','posttitle','sponsor','index','heading','content'));		 return $sponsor;     }     function getCourse(){        $course = array();        $SId = $sector['Sector']['id'];        if(isset($SId)){            $course = $this->Sector->Course->find('list', array(                'fields' => array(                    'id',                    'course_name',                ),                'conditions' => array(                    'Course.sector_id' => $SId                )            ));        }        header('Content-Type: application/json');        echo json_encode($course);        exit();     }     function getcourseajax() {        $sectorId = $this->data['sectorId'];        //pr($sectorId);die;        $course = $this->Course->find('all', array('conditions' => array('Course.sector_id' => $sectorId)));        $this->set(compact('course'));    }    function getlocationajax() {        $coursename = $this->data['coursename'];        //pr($coursename);die;        $course = $this->Course->find('all', array('conditions' => array('Course.course_name' => $coursename)));        $this->set(compact('course'));    }		function sign(){		 $this->layout ='Home';		 $user_id = $this->Auth->user('id');		 $tran = $this->TransactionLog->find('first',array('conditions'=>array('TransactionLog.user_id'=>$user_id),'order' =>array('TransactionLog.id'=>'DESC')));		 $id= $tran['TransactionLog']['id'];		 //echo $id; die;		 $book =$this->Bookinglog->find('first',array('conditions'=>array('Bookinglog.user_id'=>$user_id),'order' =>array('Bookinglog.id'=>'DESC')));		// pr($tran);die;		 $this->set(compact('tran','book'));		 //pr($this->request->data); die;		 if(!empty($this->request->data)){			$this->TransactionLog->id = $id;				//echo $id; die;				$file =	$this->request->data['TransactionLog']['sign']['name'];                $ext = substr(strtolower(strrchr($file, '.')), 1);                $arr_ext = array('jpg','png');                if (in_array($ext, $arr_ext)) {                $filename = time() . $this->request->data['TransactionLog']['sign']['name'];                 move_uploaded_file($this->request->data['TransactionLog']['sign']['tmp_name'], "img/Sign/" . $filename);                 $data['TransactionLog']['sign'] = $filename;						if ($this->TransactionLog->save($data)) {													}					}				}	}}